"use strict";(self.webpackChunklanding_master_sales_frontend=self.webpackChunklanding_master_sales_frontend||[]).push([[573],{573:(q,m,r)=>{r.r(m),r.d(m,{OrderModule:()=>W});var d=r(6895),p=r(3060),u=r(4128),e=r(4650),h=r(3063),v=r(2584),g=r(6616),f=r(4527),C=r(8423),I=r(7141),x=r(2241),y=r(3517),b=r(3861),T=r(2663),O=r(7876),_=r(5428),S=r(5830),M=r(1196);function k(i,a){1&i&&e._UZ(0,"img",23)}function N(i,a){1&i&&e._UZ(0,"img",24)}function A(i,a){1&i&&e._UZ(0,"img",25)}function E(i,a){if(1&i&&(e.TgZ(0,"div",16)(1,"div",17),e.YNc(2,k,1,0,"img",18),e.YNc(3,N,1,0,"img",19),e.YNc(4,A,1,0,"img",20),e.qZA(),e.TgZ(5,"div",21)(6,"p",22),e._uU(7),e.qZA(),e.TgZ(8,"p"),e._uU(9),e.qZA()()()),2&i){const t=a.$implicit;e.xp6(2),e.Q6J("ngIf",t.componentTradeName&&"MOVIL"===(null==t?null:t.consumptionEntityType)),e.xp6(1),e.Q6J("ngIf",t.componentTradeName&&"IFIXED"===(null==t?null:t.consumptionEntityType)),e.xp6(1),e.Q6J("ngIf",t.componentTradeName&&"TV"===(null==t?null:t.consumptionEntityType)),e.xp6(3),e.Oqu(null==t?null:t.consumptionEntityType),e.xp6(2),e.Oqu(null==t?null:t.componentOffer)}}function w(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-check-coverage",26),e.NdJ("nextCoverageStep",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeModule(n.modules.checkCoverage.alias))}),e.qZA()}if(2&i){const t=e.oxw();e.s9C("id",t.modules.checkCoverage.alias)}}function D(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-result-scoring",27),e.NdJ("nextScoringStep",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeModule(n.modules.scoring.alias))}),e.qZA()}if(2&i){const t=e.oxw();e.s9C("id",t.modules.scoring.alias)}}function Z(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-admin-client",28),e.NdJ("nextAdminClientStep",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeModule(n.modules.adminClient.alias))}),e.qZA()}if(2&i){const t=e.oxw();e.s9C("id",t.modules.adminClient.alias)}}function J(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-check-email",29),e.NdJ("nextCheckEmailStep",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeModule(n.modules.checkEmail.alias))}),e.qZA()}if(2&i){const t=e.oxw();e.s9C("id",t.modules.checkEmail.alias)}}function L(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-documents",30),e.NdJ("nextDocumentStep",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeModule(n.modules.documents.alias))}),e.qZA()}if(2&i){const t=e.oxw();e.s9C("id",t.modules.documents.alias)}}function F(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-movil-list",31),e.NdJ("nextMovilListStep",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeModule(n.modules.movillist.alias))}),e.qZA()}if(2&i){const t=e.oxw();e.s9C("id",t.modules.movillist.alias)}}function Y(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-delivery-method",32),e.NdJ("nextDeliveryMethodStep",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeModule(n.modules.deliverymethod.alias))}),e.qZA()}if(2&i){const t=e.oxw();e.s9C("id",t.modules.deliverymethod.alias)}}function P(i,a){if(1&i&&e._UZ(0,"app-almost-done",33),2&i){const t=e.oxw();e.Q6J("id",t.modules.almostdone.alias)}}const V=[{path:"",component:(()=>{class i{constructor(t,o,n,s,l,c){this.webstoreservice=t,this.breservices=o,this.tokenService=n,this.scroller=s,this.ordersService=l,this.spinner=c,this.showCoverage=!0,this.showScoring=!0,this.orderTabs=[],this.modules={checkCoverage:{visible:!1,active:!1,enabled:!0,alias:"checkcoverage"},scoring:{visible:!1,active:!1,enabled:!0,alias:"scoring"},adminClient:{visible:!1,active:!1,enabled:!0,alias:"adminclient"},checkEmail:{visible:!1,active:!1,enabled:!0,alias:"checkemail"},documents:{visible:!1,active:!1,enabled:!0,alias:"documents"},movillist:{visible:!1,active:!1,enabled:!0,alias:"movillist"},deliverymethod:{visible:!1,active:!1,enabled:!0,alias:"deliverymethod"},almostdone:{visible:!1,active:!1,enabled:!0,alias:"almostdone"}}}ngOnInit(){this.spinner.show(),this.planCompositionCode=this.webstoreservice.getPlanCompositionCode(),this.planComposition=this.webstoreservice.getPlanComposition(),this.planList=this.planComposition?.planList,this.getToken()}loadBussinesRules(){this.breservices.coverageEvaluation(this.autentication.data.token).subscribe({next:t=>{this.coverageData=t,this.scoringStatus=this.webstoreservice.getStatusScoring(),this.initializeComponents()},error:t=>{alert("Ocurrion un error en los servicios de necesidad de evaluacion cobertura, Intenta nuevamente por favor"),this.spinner.hide(),console.log(t)}})}initializeComponents(){"OK"==this.coverageData.data.requireCoverageVerification?this.modules.checkCoverage.visible=!0:this.modules.checkCoverage.enabled=!1,this.modules.scoring.enabled="NORMAL"==this.scoringStatus,this.modules.scoring.visible=this.modules.scoring.enabled&&!this.modules.checkCoverage.visible,this.modules.adminClient.visible=!this.modules.scoring.visible&&!this.modules.checkCoverage.visible}getToken(){this.tokenService.gettoken().subscribe({next:t=>{this.autentication=t,this.webstoreservice.saveDataInSession("userId",t.data?.userId),this.createOrder()},error:t=>{alert("Ocurrio un problema en los servicios de Autentificacion, Intente nuevamente por favor"),this.spinner.hide(),console.log(t)}})}changeModule(t){console.log(t);var o=this;switch(t){case"checkcoverage":this.modules.scoring.enabled?(this.modules.scoring.visible=!0,setTimeout(function(){o.scroller.scrollToAnchor("scoring")},1e3)):this.changeModule("scoring");break;case"scoring":this.modules.adminClient.enabled?(this.modules.adminClient.visible=!0,setTimeout(function(){o.scroller.scrollToAnchor("adminclient")},1e3)):this.changeModule("adminclient");break;case"adminclient":this.modules.checkEmail.enabled?(this.modules.checkEmail.visible=!0,setTimeout(function(){o.scroller.scrollToAnchor("checkemail")},1e3)):this.changeModule("checkemail");break;case"checkemail":this.modules.documents.enabled?(this.modules.documents.visible=!0,setTimeout(function(){o.scroller.scrollToAnchor("documents")},1e3)):this.changeModule("documents");break;case"documents":this.modules.movillist.enabled?(this.modules.movillist.visible=!0,setTimeout(function(){o.scroller.scrollToAnchor("movillist")},1e3)):this.changeModule("movillist");break;case"movillist":this.modules.deliverymethod.enabled?(this.modules.deliverymethod.visible=!0,setTimeout(function(){o.scroller.scrollToAnchor("deliverymethod")},1e3)):this.changeModule("deliverymethod")}}createOrder(){const t=this.webstoreservice.getClientInformation();this.ordersService.createOrder({orderType:"PTFSALE",orderTypeName:"VENTAS",partyId:t.personId,fullName:t.fullName,customerId:t.clientId,channelCode:"CAATCL",channelName:"ATENCION AL CLIENTE",workplaceCode:"TIEEDISSA",workplaceName:"Tienda Edificio Issa",cityCode:t.documentCity,cityName:t.documentCityDesc,userId:this.autentication.data.userId,userName:"landing",userFullName:"landing",userRoleCode:"ROL_ASESOR_3"},this.autentication.data.token).subscribe({next:n=>{console.log(n),this.webstoreservice.saveDataInSession("orderMainId",n.data.data.orderMainId),this.registerCommercialOffer(n.data.data.orderMainId)},error:n=>{alert("Ocurrion un error en los servicios de creacion de orden, Intenta nuevamente por favor"),this.spinner.hide(),console.log(n)}})}registerCommercialOffer(t){const o=this.webstoreservice.getPlanComposition(),n={orderId:t,sequence:0,userId:this.autentication.data.userId,microFrontendId:"commercial-offers-microfront-app",microFrontendData:JSON.stringify(o),statusCode:"INI"};this.ordersService.registerOrderView(n,this.autentication.data.token).subscribe({next:s=>{console.log(s),this.loadBussinesRules(),this.loadItemsPlan()},error:s=>{alert("Ocurrio un error en los servicios de creacion de la Order View, intente nuevamente por favor"),this.spinner.hide(),console.log(s)}})}loadItemsPlan(){const t={planCompositionCode:this.webstoreservice.getPlanCompositionCode(),userId:this.autentication.data.userId};this.ordersService.getItemsPlan(t,this.autentication.data.token).subscribe({next:o=>{console.log(o),this.webstoreservice.saveDataInSession("itemsPlan",o.data.data),this.buildMandatoryItems(o.data.data)},error:o=>{alert("Ocurrio un error en los servicios recoleccion de items para el plan, intente nuevamente por favor"),this.spinner.hide(),console.log(o)}})}buildMandatoryItems(t){let o=[];for(let n=0;n<t.planList.length;n++){const s=t.planList[n];for(let l=0;l<s.itemTypeList.length;l++){const c=s.itemTypeList[l];if("1"===c.isMandatory){const $={componentCategoryId:s.componentCategoryId,componentCode:s.componentCode,itemCode:c.itemList[0].itemCode,itemDescription:c.itemList[0].itemDescription,quantity:c.quantity,itemType:c.itemType,planCode:s.planCode,consumptionEntityType:s.consumptionEntityType,planCompositionCode:this.webstoreservice.getPlanCompositionCode(),userId:this.autentication.data.userId};o.push($)}}}console.log("mandatoryItemsPlan",o),this.webstoreservice.saveDataInSession("mandatoryItemsPlan",o),this.getValuesItems(o)}getDataItem(t){return new Promise(o=>{this.ordersService.getItemDetail(t,this.autentication.data.token).subscribe(n=>{console.log("getItemDetail",n);let s=n.data.data;s.consumptionEntityType=t.consumptionEntityType,s.componentTradeName=t.consumptionEntityType,s.componentCategoryId=t.componentCategoryId,s.planCode=t.planCode,s.componentCode=t.componentCode,s.itemTypeCode=t.itemType,s.quantity=t.quantity,s.quantityItem=t.quantity,s.isMandatory="1",s.isVisible=1,o(s)})})}getValuesItems(t){let o=[];for(let n=0;n<t.length;n++){let l=this.getDataItem(t[n]);o.push(l)}(0,u.D)(o).subscribe({next:n=>{console.log("responses",n),this.registerOrderViewItems(n,!1),this.webstoreservice.saveDataInSession("mandatoryItemsPlan",n)},error:n=>{alert("Ocurrio un error en los servicios forkJoins, intente nuevamente por favor"),this.spinner.hide(),console.log(n)}})}registerOrderViewItems(t,o){const n={orderId:this.webstoreservice.getDataInSession("orderMainId"),sequence:0,userId:this.autentication.data.userId,microFrontendId:"additional-items-setup-microfront-app",microFrontendData:JSON.stringify(t),statusCode:"INI"};this.ordersService.registerOrderView(n,this.autentication.data.token).subscribe({next:s=>{console.log("registerOrderView",s),o?this.spinner.hide():this.registerItemsSale()},error:s=>{alert("Ocurrio un error en los servicios de registro de order view, intente nuevamente por favor"),this.spinner.hide(),console.log(s)}})}registerItemsSale(){const t={orderId:this.webstoreservice.getDataInSession("orderMainId")};this.ordersService.registerItemsSale(t,this.autentication.data.token).subscribe({next:o=>{console.log("registerItemsSale",o),this.registerOrderViewItems(o.data.data.itemsOrderList,!0),this.webstoreservice.saveDataInSession("mandatoryItemsPlan",o.data.data.itemsOrderList)},error:o=>{alert("Ocurrio un error en los servicios de registro de items para la venta, intente nuevamente por favor"),this.spinner.hide(),console.log(o)}})}submitOrder(){}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.f),e.Y36(v.Y),e.Y36(g.B),e.Y36(d.EM),e.Y36(f.N),e.Y36(C.t2))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-order"]],decls:19,vars:10,consts:[[1,"container"],[1,"row"],[1,"d-none","d-md-block","col-5","bg","bg-light","bg-gradient","border","py-5","px-5","my-1"],[1,"sticky-top"],[1,"section-body","col-12","py-3"],[1,"d-flex","flex-column","justify-content-around","align-items-center"],["class","row w-100 border-top pt-2",4,"ngFor","ngForOf"],[1,"col-12","col-md-7"],[3,"id","nextCoverageStep",4,"ngIf"],[3,"id","nextScoringStep",4,"ngIf"],[3,"id","nextAdminClientStep",4,"ngIf"],[3,"id","nextCheckEmailStep",4,"ngIf"],[3,"id","nextDocumentStep",4,"ngIf"],[3,"id","nextMovilListStep",4,"ngIf"],[3,"id","nextDeliveryMethodStep",4,"ngIf"],[3,"id",4,"ngIf"],[1,"row","w-100","border-top","pt-2"],[1,"col-1","text-end"],["src","assets/images/iconos/movil.png","alt","","style","width: 20px; height: auto;",4,"ngIf"],["src","assets/images/iconos/wifi.png","alt","","style","width: 25px; height: auto;",4,"ngIf"],["src","assets/images/iconos/tv.png","alt","","style","width: 25px; height: auto;",4,"ngIf"],[1,"col-11"],[1,"component-title","mb-0","fw-bold"],["src","assets/images/iconos/movil.png","alt","",2,"width","20px","height","auto"],["src","assets/images/iconos/wifi.png","alt","",2,"width","25px","height","auto"],["src","assets/images/iconos/tv.png","alt","",2,"width","25px","height","auto"],[3,"id","nextCoverageStep"],[3,"id","nextScoringStep"],[3,"id","nextAdminClientStep"],[3,"id","nextCheckEmailStep"],[3,"id","nextDocumentStep"],[3,"id","nextMovilListStep"],[3,"id","nextDeliveryMethodStep"],[3,"id"]],template:function(t,o){1&t&&(e._UZ(0,"app-header"),e.TgZ(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"section",4)(6,"div",5)(7,"h3"),e._uU(8),e.qZA(),e.YNc(9,E,10,5,"div",6),e.qZA()()()(),e.TgZ(10,"div",7),e.YNc(11,w,1,1,"app-check-coverage",8),e.YNc(12,D,1,1,"app-result-scoring",9),e.YNc(13,Z,1,1,"app-admin-client",10),e.YNc(14,J,1,1,"app-check-email",11),e.YNc(15,L,1,1,"app-documents",12),e.YNc(16,F,1,1,"app-movil-list",13),e.YNc(17,Y,1,1,"app-delivery-method",14),e.YNc(18,P,1,1,"app-almost-done",15),e.qZA()()()),2&t&&(e.xp6(8),e.Oqu(null==o.planComposition?null:o.planComposition.groupTradeName),e.xp6(1),e.Q6J("ngForOf",null==o.planComposition?null:o.planComposition.planList),e.xp6(2),e.Q6J("ngIf",o.modules.checkCoverage.visible),e.xp6(1),e.Q6J("ngIf",o.modules.scoring.visible),e.xp6(1),e.Q6J("ngIf",o.modules.adminClient.visible),e.xp6(1),e.Q6J("ngIf",o.modules.checkEmail.visible),e.xp6(1),e.Q6J("ngIf",o.modules.documents.visible),e.xp6(1),e.Q6J("ngIf",o.modules.movillist.visible),e.xp6(1),e.Q6J("ngIf",o.modules.deliverymethod.visible),e.xp6(1),e.Q6J("ngIf",o.modules.almostdone.visible))},dependencies:[d.sg,d.O5,I.T,x.r,y.W,b.A,T.A,O.G,_.h,S.M,M.A]}),i})()}];let Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.Bz.forChild(V),p.Bz]}),i})();var R=r(931),G=r(5780),K=r(3434),U=r(605),B=r(1102),H=r(3720),z=r(5380),j=r(1083),X=r(635);let W=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[d.ez,Q,R.CheckCoverageModule,G.AdminClientModule,K.CheckEmailModule,U.DocumentsModule,B.ResultScoringModule,H.O,z.MovilListModule,j.DeliveryMethodModule,X.AlmostDoneModule]}),i})()}}]);