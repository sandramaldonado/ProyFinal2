"use strict";(self.webpackChunklanding_master_sales_frontend=self.webpackChunklanding_master_sales_frontend||[]).push([[605],{3861:(k,I,u)=>{u.d(I,{A:()=>v});var x=u(655),e=u(4650),S=u(6748),C=u(5219),w=u(9886),Z=u(5861),g=(()=>{return(o=g||(g={}))[o.Up=1]="Up",o[o.Down=3]="Down",o[o.Right=6]="Right",o[o.Left=8]="Left",o[o.UpMirrored=2]="UpMirrored",o[o.DownMirrored=4]="DownMirrored",o[o.LeftMirrored=5]="LeftMirrored",o[o.RightMirrored=7]="RightMirrored",o[o.Default=0]="Default",o[o.NotJpeg=-1]="NotJpeg",o[o.NotDefined=-2]="NotDefined",g;var o})();class l{}l.getOrientation=o=>new Promise((i,t)=>{try{const s=new FileReader;s.onload=()=>{const r=new DataView(s.result);if(!r.byteLength||65496!==r.getUint16(0,!1))return i(g.NotDefined);const c=r.byteLength;let n=2;for(;n<c;){const d=r.getUint16(n,!1);if(n+=2,65505===d){if(1165519206!==r.getUint32(n+=2,!1))return i(g.NotJpeg);const f=18761===r.getUint16(n+=6,!1);n+=r.getUint32(n+4,f);const p=r.getUint16(n,f);n+=2;for(let a=0;a<p;a++)if(274===r.getUint16(n+12*a,f))return i(r.getUint16(n+12*a+8,f))}else{if(65280!=(65280&d))break;n+=r.getUint16(n,!1)}}return i(g.NotJpeg)},s.readAsArrayBuffer(o)}catch{return t(g.Default)}}),l.uploadFile=(o,i=!0,t=!1)=>new Promise(function(s,r){const c=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);Promise.resolve(c).then(n=>n?l.generateUploadInputNative(window.document,i,t):l.generateUploadInputRenderer(o,i,t)).then(n=>{const d=n?Array.from(n):[],f=d.map(m=>l.getOrientation(m)),p=d.map(m=>l.fileToDataURL(m));let a=[];Promise.all(f).then(m=>(a=m,Promise.all(p))).then(m=>{const D=m.map((b,J)=>({image:b.dataUrl,orientation:a[J],fileName:b.fileName}));s(i?D:D[0])})}).catch(n=>r(n))}),l.fileToDataURL=o=>new Promise((i,t)=>{const s=new FileReader;s.onload=r=>{i({dataUrl:r.target.result,fileName:o.name})};try{s.readAsDataURL(o)}catch(r){t(`ngx-image-compress - probably no file have been selected: ${r}`)}}),l.generateUploadInputRenderer=(o,i=!0,t=!1)=>{let s=!1;return new Promise((r,c)=>{const n=o.createElement("input");o.setStyle(n,"display","none"),o.setProperty(n,"type","file"),o.setProperty(n,"accept","image/*"),i&&o.setProperty(n,"multiple","true"),o.listen(n,"click",d=>{d.target.value=""}),o.listen(n,"change",d=>{s=!0,r(d.target.files)}),t&&window.addEventListener("focus",()=>{setTimeout(()=>{s||c(new Error("file upload on blur - no file selected"))},300)},{once:!0}),n.click()})},l.generateUploadInputNative=(o,i=!0,t=!1)=>{let s=!1;return new Promise((r,c)=>{const n=o.createElement("input");n.id="upload-input"+new Date,n.style.display="none",n.setAttribute("type","file"),i&&n.setAttribute("multiple","true"),o.body.appendChild(n),n.addEventListener("change",()=>{s=!0,r(n.files),o.body.removeChild(o.getElementById(n.id))},{once:!0}),t&&window.addEventListener("focus",()=>{setTimeout(()=>{!s&&o.getElementById(n.id)&&(c(new Error("file upload on blur - no file selected")),o.body.removeChild(o.getElementById(n.id)))},300)},{once:!0}),n.click()})},l.compress=(o,i,t,s=50,r=50,c=0,n=0)=>new Promise(function(d,f){r/=100,s/=100;const p=new Image;p.onload=()=>{const a=t.createElement("canvas"),m=a.getContext("2d");if(!m)return f("No canvas context available");let D=p.naturalWidth,b=p.naturalHeight;if(!CSS.supports("image-orientation","from-image")&&(i===g.Right||i===g.Left)){const W=D;D=b,b=W}s=Math.min(s,c?c/D:1,n?n/b:1),a.width=D*s,a.height=b*s;const _=Math.PI/180;CSS.supports("image-orientation","from-image")||i===g.Up?m.drawImage(p,0,0,a.width,a.height):i===g.Right?(m.save(),m.rotate(90*_),m.translate(0,-a.width),m.drawImage(p,0,0,a.height,a.width),m.restore()):i===g.Left?(m.save(),m.rotate(-90*_),m.translate(-a.width,0),m.drawImage(p,0,0,a.height,a.width),m.restore()):i===g.Down?(m.save(),m.rotate(180*_),m.translate(-a.width,-a.height),m.drawImage(p,0,0,a.width,a.height),m.restore()):m.drawImage(p,0,0,a.width,a.height);const E=o.substr(5,o.split(";")[0].length-5),K=a.toDataURL(E,r);d(K)},p.onerror=a=>f(a),p.src=o}),l.byteCount=o=>encodeURI(o).split(/%..|./).length-1,l.getImageMaxSize=function(){var o=(0,Z.Z)(function*(i,t,s){const c=f=>(f/1024/1024).toFixed(2);t&&console.debug("NgxImageCompress - Opening upload window");let d,n=yield l.uploadFile(s,!1);for(let f=0;f<10;f++){const p=l.byteCount(n.image);d=yield l.compress(n.image,n.orientation,s,50,100);const a=l.byteCount(d);if(console.debug("NgxImageCompress -","Compression from",c(p),"MB to",c(a),"MB"),a>=p)throw 0===f?(t&&console.debug("NgxImageCompress -","File can't be reduced at all - returning the original",c(p),"MB large"),n.image):(t&&console.debug("NgxImageCompress -","File can't be reduced more - returning the best we can, which is ",c(p),"MB large"),n.image);if(a<1024*i*1024)return t&&console.debug("NgxImageCompress -","Here your file",c(a),"MB large"),d;if(9===f)throw t&&console.debug("NgxImageCompress -","File can't reach the desired size after",10,"tries. Returning file ",c(p),"MB large"),n.image;t&&console.debug("NgxImageCompress -","Reached",c(a),"MB large. Trying another time after",f+1,"times"),n.image=d}throw t&&console.debug("NgxImageCompress - Unexpected error"),""});return function(i,t,s){return o.apply(this,arguments)}}();let M=(()=>{class o{constructor(t){this.DOC_ORIENTATION=g,this.render=t.createRenderer(null,null)}byteCount(t){return l.byteCount(t)}getOrientation(t){return l.getOrientation(t)}uploadFile(){return l.uploadFile(this.render,!1)}uploadMultipleFiles(){return l.uploadFile(this.render,!0)}uploadFileOrReject(){return l.uploadFile(this.render,!1,!0)}uploadMultipleFilesOrReject(){return l.uploadFile(this.render,!0,!0)}compressFile(t,s,r=50,c=50,n=0,d=0){return l.compress(t,s,this.render,r,c,n,d)}uploadAndGetImageWithMaxSize(t=1,s=!1){return l.getImageMaxSize(t,s,this.render)}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(e.FYo))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var U=u(3063),h=u(4527),F=u(6895),y=u(3546),T=u(4859),Q=u(7392),L=u(42),B=u(9717);function R(o,i){1&o&&e._UZ(0,"img",12)}function A(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e._UZ(1,"img",14),e.TgZ(2,"button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.removeFirstDocument())}),e.TgZ(3,"mat-icon"),e._uU(4,"delete_outline"),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("src",t.firstDocument,e.LSH)}}function V(o,i){1&o&&e._UZ(0,"img",12)}function z(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",16),e._uU(2,"Vista Previa"),e.qZA(),e._UZ(3,"img",14),e.TgZ(4,"button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.removeSecondDocument())}),e.TgZ(5,"mat-icon"),e._uU(6,"delete_outline"),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("src",t.secondDocument,e.LSH)}}function Y(o,i){1&o&&e._UZ(0,"img",12)}function H(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",16),e._uU(2,"Vista Previa"),e.qZA(),e._UZ(3,"img",14),e.TgZ(4,"button",17),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.removeFacePicture())}),e.TgZ(5,"mat-icon"),e._uU(6,"delete_outline"),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("src",t.facePicture,e.LSH)}}function N(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"app-button",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.next())}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",!t.firstDocumentIsValid||!t.firstDocumentIsValid||!t.facePictureIsValid)("content","Siguiente")}}class v{constructor(i,t,s,r){this.modalService=i,this.imageCompress=t,this.webstoreService=s,this.ordersService=r,this.nextDocumentStep=new e.vpe,this.visited=!1,this.firstDocumentIsValid=!1,this.secondDocumentIsValid=!1,this.facePictureIsValid=!1}ngOnInit(){console.log("init documents")}openModalWithComponent(){}uploadFirstDocument(){this.uploadAndCompress("firstDocument"),this.firstDocumentIsValid=!0}takePictureFirstDocument(){this.bsModalRef=this.modalService.show(S.Q,{initialState:{source:"firstDocument"}}),this.bsModalRef.content.closeBtnName="Close"}uploadSecondDocument(){this.secondDocumentIsValid=!0,this.uploadAndCompress("secondDocument")}takePictureSecondDocument(){this.bsModalRef=this.modalService.show(S.Q,{initialState:{source:"secondDocument"}}),this.bsModalRef.content.closeBtnName="Close"}uploadFacePicture(){this.facePictureIsValid=!0,this.uploadAndCompress("facePicture")}takeFacePicture(){this.bsModalRef=this.modalService.show(S.Q,{initialState:{source:"facePicture"}}),this.bsModalRef.content.closeBtnName="Close"}uploadAndCompress(i){let t=this;this.imageCompress.uploadFile().then(({image:s,orientation:r})=>{let c=this.imageCompress.byteCount(s);if(c>4e5){console.log("Size in bytes was:",this.imageCompress.byteCount(s));let n=100;n=c<=5e5?80:c<1e6?70:c<2e6?60:c<5e6?40:c<7e6?30:c<1e7?20:10,this.imageCompress.compressFile(s,r,n,90).then(d=>{t.webstoreService.saveDocument(i,d),console.log("(>400000)Size in bytes is now:",this.imageCompress.byteCount(d))})}else this.imageCompress.compressFile(s,r,90,90).then(n=>{t.webstoreService.saveDocument(i,n),console.log("(<400000)Size in bytes after compression is now:",this.imageCompress.byteCount(n))})}).catch(s=>{})}removeFirstDocument(){this.firstDocumentIsValid=!1,this.webstoreService.saveDocument("firstDocument","")}removeSecondDocument(){this.secondDocumentIsValid=!1,this.webstoreService.saveDocument("secondDocument","")}removeFacePicture(){this.facePictureIsValid=!1,this.webstoreService.saveDocument("facePicture","")}validateDocuments(){let i=!1;return i=""!=this.firstDocument&&""!=this.secondDocument&&""!=this.facePicture,i}next(){this.visited=!0,this.nextDocumentStep.emit(!0),this.registerDocuments()}formatImgData(i){let t=i.split(",");return t.length>1?t[1]:t[0]}registerDocuments(){const i=this.webstoreService.getClientInformation(),t=this.formatImgData(this.webstoreService.getDataInSession("firstDocument")),s=this.formatImgData(this.webstoreService.getDataInSession("secondDocument")),r=this.formatImgData(this.webstoreService.getDataInSession("facePicture")),c={partyId:i.personId,partyName:i.fullName,orderType:"PTFSALE",serviceType:"NORMAL",orderId:this.webstoreService.getDataInSession("orderMainId"),documents:[{fileCode:"CI_FRONT",fileFormat:"png",file:t},{fileCode:"CI_BACK",fileFormat:"png",file:s},{fileCode:"PHOTO_CUSTOMER",fileFormat:"png",file:r}]};console.log(JSON.stringify(c)),this.ordersService.uploadDocuments(c,this.webstoreService.getDataInSession("token")).subscribe(n=>{console.log(n),this.registerDocumentsOrder({documents:n})})}registerDocumentsOrder(i){const t={orderId:this.webstoreService.getDataInSession("orderMainId"),sequence:4,userId:this.webstoreService.getDataInSession("userId"),microFrontendId:"digitization-sale-microfront-app",microFrontendData:JSON.stringify(i),statusCode:"INI"};this.ordersService.registerOrderView(t,this.webstoreService.getDataInSession("token")).subscribe(s=>{console.log(s)})}}v.\u0275fac=function(i){return new(i||v)(e.Y36(w.tT),e.Y36(M),e.Y36(U.f),e.Y36(h.N))},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-documents"]],outputs:{nextDocumentStep:"nextDocumentStep"},decls:36,vars:13,consts:[[1,"container"],[1,"row","pb-3"],[1,"section-body","col-12","py-3"],[1,"d-flex","flex-column","justify-content-around","align-items-center"],[1,"my-3","border"],[1,"text-center"],[1,"d-flex","flex-column","justify-content-between","align-items-center","py-5"],["src","assets/images/iconos/picture.png","alt","","class","pb-2",4,"ngIf"],["class"," border rounded mt-2 mt-lg-0 p-2","style","background-color: white; position: relative;",4,"ngIf"],[3,"content","click"],["class","border rounded mt-2 mt-lg-0 p-2","style","background-color: white; position: relative;",4,"ngIf"],[3,"disabled","content","click",4,"ngIf"],["src","assets/images/iconos/picture.png","alt","",1,"pb-2"],[1,"border","rounded","mt-2","mt-lg-0","p-2",2,"background-color","white","position","relative"],[1,"",2,"min-height","200px","width","270px","height","auto",3,"src"],["mat-fab","","color","primary",1,"btn-remove",2,"position","absolute","top","10px","right","0",3,"click"],[1,"snapshot-title","text-center"],["mat-fab","","color","primary",2,"position","absolute","top","10px","right","0",3,"click"],[3,"disabled","content","click"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"section",2)(3,"div",3)(4,"h3"),e._uU(5,"Documentos de identidad"),e.qZA(),e.TgZ(6,"p"),e._uU(7,"Necesitamos verificar tu identidad con tus documentos legales."),e.qZA(),e.TgZ(8,"mat-card",4)(9,"mat-card-content",5)(10,"div",6),e.YNc(11,R,1,0,"img",7),e.YNc(12,A,5,1,"div",8),e.TgZ(13,"p"),e._uU(14,"Sube la fotograf\xeda de CI (anverso) "),e.qZA(),e.TgZ(15,"app-button",9),e.NdJ("click",function(){return t.uploadFirstDocument()}),e.qZA(),e.TgZ(16,"app-button-outline",9),e.NdJ("click",function(){return t.takePictureFirstDocument()}),e.qZA()()()(),e.TgZ(17,"mat-card",4)(18,"mat-card-content",5)(19,"div",6),e.YNc(20,V,1,0,"img",7),e.YNc(21,z,7,1,"div",10),e.TgZ(22,"p"),e._uU(23,"Sube la fotograf\xeda de CI (reverso)"),e.qZA(),e.TgZ(24,"app-button",9),e.NdJ("click",function(){return t.uploadSecondDocument()}),e.qZA(),e.TgZ(25,"app-button-outline",9),e.NdJ("click",function(){return t.takePictureSecondDocument()}),e.qZA()()()(),e.TgZ(26,"mat-card",4)(27,"mat-card-content",5)(28,"div",6),e.YNc(29,Y,1,0,"img",7),e.YNc(30,H,7,1,"div",10),e.TgZ(31,"p"),e._uU(32,"Sube la fotograf\xeda de ti sin gorra o algo q tape tu rostro"),e.qZA(),e.TgZ(33,"app-button",9),e.NdJ("click",function(){return t.uploadFacePicture()}),e.qZA(),e.TgZ(34,"app-button-outline",9),e.NdJ("click",function(){return t.takeFacePicture()}),e.qZA()()()(),e.YNc(35,N,1,2,"app-button",11),e.qZA()()()()),2&i&&(e.xp6(11),e.Q6J("ngIf",!t.firstDocument||""===t.firstDocument),e.xp6(1),e.Q6J("ngIf",t.firstDocument&&""!==t.firstDocument),e.xp6(3),e.Q6J("content","Subir imagen"),e.xp6(1),e.Q6J("content","Tomar fotografia"),e.xp6(4),e.Q6J("ngIf",!t.secondDocument||""===t.secondDocument),e.xp6(1),e.Q6J("ngIf",t.secondDocument&&""!==t.secondDocument),e.xp6(3),e.Q6J("content","Subir imagen"),e.xp6(1),e.Q6J("content","Tomar fotografia"),e.xp6(4),e.Q6J("ngIf",!t.facePicture||""===t.facePicture),e.xp6(1),e.Q6J("ngIf",t.facePicture&&""!==t.facePicture),e.xp6(3),e.Q6J("content","Subir imagen"),e.xp6(1),e.Q6J("content","Tomar fotografia"),e.xp6(1),e.Q6J("ngIf",!t.visited))},dependencies:[F.O5,y.a8,y.dn,T.lW,Q.Hw,L.r,B.Y],styles:[".mat-card[_ngcontent-%COMP%]{padding:1px!important;width:100%;color:#7b7b7b}.section-body[_ngcontent-%COMP%]{background:white;color:#848484}"]}),(0,x.gn)([(0,C.xg)("firstDocument")],v.prototype,"firstDocument",void 0),(0,x.gn)([(0,C.xg)("secondDocument")],v.prototype,"secondDocument",void 0),(0,x.gn)([(0,C.xg)("facePicture")],v.prototype,"facePicture",void 0)},605:(k,I,u)=>{u.r(I),u.d(I,{DocumentsModule:()=>U});var x=u(6895),e=u(3546),S=u(3060),C=u(3861),w=u(4650);const Z=[{path:"",component:C.A}];let g=(()=>{class h{}return h.\u0275fac=function(y){return new(y||h)},h.\u0275mod=w.oAB({type:h}),h.\u0275inj=w.cJS({imports:[S.Bz.forChild(Z),S.Bz]}),h})();var P=u(4859),l=u(7392),M=u(4466);let U=(()=>{class h{}return h.\u0275fac=function(y){return new(y||h)},h.\u0275mod=w.oAB({type:h}),h.\u0275inj=w.cJS({imports:[x.ez,g,e.QW,P.ot,l.Ps,M.m]}),h})()}}]);